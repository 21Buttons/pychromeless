services:
- docker
env:
  global:
  - GLIMPSE_BUCKET_NAME=glimpsefiles
  - GLIMPSE_FUNCTION_DIR=test/function/
  - secure: OpAR7Te7TvxzeIMCtpDC7rTTYijrWlh9LtCB8EBYzZkcAmKUicb/Amiocl2x6EPlkFqZXcX0acuZvEbhfrZlRrhcmSTOujHkGQk/u6j2W96v5cQ2udW03XVv24Q3suP7qmANAe+T6wfKLj7FPtP/L+IkN3gVw1rzxQP2dJZMvbS9qXul8+VdwaFqsw5i6v2ys3jpFnYtkYGttXrR6LGXVQ9iv9SJkcKYXYBOs/H2upL1pRsJHbldsQqaWQ3f34Cl4jSv/+PM3YABmol94pZqaVOkItdJFtzYoL5VV9taF/uIIOykfVEwI0hMXOfm0H/BIGCgChYnNztqfM39tCeeH1QSUaF7rS8tNwa5AKJEQkDvoQyjcWHEHtQJk8VkmvRcw/YF8zOAymfbpN72L5jy+vhabreaIt14ZsABmerL2F40gyH07KMI6UYrMT6Nnz3aAqYs+2NcwEo6mKGyk9fcXA0UT4vpApexoxbLSD57b5VVvkoMMzpg9OJUu1VzI0Rqug2sgmX4dPQda3RBCL03O2TRdUL4WaGUnWOpLyhz08d7Xh5OkIo6I4uq9XtHi7Sd7D9gi6Vzp+PbQUvpwZqnXOL3hU0GvohwuQqvgKdSkQTcecdVbwtCl1qLriU6Z54nCbSOpWaIJ2Tc4wG7CMZDEaZR4cazokS6xXSCYxM3wfk=
  - secure: OdjTzGgDsSatEvPBuND4y9QNjusTXcJVuBApXq1p6Sa4tX/6zrqB4k1Su1z+WfvdPlWaJ81BoQjlWnhEbKvBibOEImM2Fw7nbKntYmSyLprG6s5UHfQ4pTxaF35FdpsWOxenLywmjPr/U9JZ5Qdwce53FAg3hqAeAdE/09jIwefoWHR9kP3UBJOV0WKaYvAmnBjypJufT985hRNN59DFQnVtJWikU77vp604ArX+7jGNBOg+9huhegIpqTApEJuNX2+bkwRROCx/fAYFjrff/qOPFTFJbBToPLGNLawgDlEzZ/iXwDjBxm01U/gii+ixPv/6zm6BwLOg/tzfPHEodEHde9zEgH9rd1dEC08CnqY2SJOpKBNjdKudvdZiVpNKJEye/ebOoUSh9oRCPUjfwIkQN1fzvMat51Fto81QXbq503m+jCgISoYAWaPLFUvA0ijWnfqHOzUlzIbDoDvznPtkW/1N+JfDE8VfzMJNGT7TMD38wTIhPQYU88hJe1tw0n0sf8GoFfPs5VmIu/x1Yk5aus3lu3IQW530CqKOuyHRODjfpyBrWtUTJx7Fjk8goRuaey9/gDXL4XYyNRjx2qz4UdFi+MKuezxD9EkU2Lqt3PKEAhW6zdk268rLLgSl/1PAvQomLogbERcYwzzVdVvsp0xVZcCBdIgOuu5ERCc=
before_script:
- make build
script:
- make run URL=https://google.com
- make update URL=https://google.com
- make update URL=1.1.1.1
- make update URL=http://letmeoutofyour.net:8081/
- make update URL=https://httpbin.org/redirect/6
- make update URL=https://httpbin.org/image/png
- make update URL=https://httpbin.org/headers
- make run URL=file:///etc/passwd || echo "SAVED - Made to fail"
- make run URL=gibberish || echo "SAVED - Made to fail"
- make run URL=mjnjvfidrilyenbbvjwisyzdpycppftjombbxqrtvkcpsbxdnllqupptmhancjqimgcpsfuhzjpdkiaibkcigwyrmaajjszyxvyjekbobdzluepicwnelaaljhkqzmqdupjbhercywvvomwzfszzeptaeaiofiohixlzfwjnlgvilyklivymuknqybunftprnvotjviimcttlyjqfhdefapbpzvzugghzaisdyrmebjurqtzbbheomgmentccdekijireporxxmvqneebbrfzhvgbydzmiaewpqopnxzdsrt
  || echo "Made to fail"
before_deploy:
- make pack
deploy:
  provider: s3
  access_key_id:
    secure: OpAR7Te7TvxzeIMCtpDC7rTTYijrWlh9LtCB8EBYzZkcAmKUicb/Amiocl2x6EPlkFqZXcX0acuZvEbhfrZlRrhcmSTOujHkGQk/u6j2W96v5cQ2udW03XVv24Q3suP7qmANAe+T6wfKLj7FPtP/L+IkN3gVw1rzxQP2dJZMvbS9qXul8+VdwaFqsw5i6v2ys3jpFnYtkYGttXrR6LGXVQ9iv9SJkcKYXYBOs/H2upL1pRsJHbldsQqaWQ3f34Cl4jSv/+PM3YABmol94pZqaVOkItdJFtzYoL5VV9taF/uIIOykfVEwI0hMXOfm0H/BIGCgChYnNztqfM39tCeeH1QSUaF7rS8tNwa5AKJEQkDvoQyjcWHEHtQJk8VkmvRcw/YF8zOAymfbpN72L5jy+vhabreaIt14ZsABmerL2F40gyH07KMI6UYrMT6Nnz3aAqYs+2NcwEo6mKGyk9fcXA0UT4vpApexoxbLSD57b5VVvkoMMzpg9OJUu1VzI0Rqug2sgmX4dPQda3RBCL03O2TRdUL4WaGUnWOpLyhz08d7Xh5OkIo6I4uq9XtHi7Sd7D9gi6Vzp+PbQUvpwZqnXOL3hU0GvohwuQqvgKdSkQTcecdVbwtCl1qLriU6Z54nCbSOpWaIJ2Tc4wG7CMZDEaZR4cazokS6xXSCYxM3wfk=
    # secure: 04W7ckwzoGdRDh4pnEqwCzZmDmSFRg2lpeTfFqftFLubByBgluuCBS0+2dezJgSytW3WNhsshjKDBCeSoXdCBvnGgfv5FvH8lieL2nfY4Q0u+8NAQ/FtaoUBxdTZmHYryHfcR2zAneBcViFG9iCQtVoUCaHcvyU+ldBggC6eLXxacGxOKP6cwSjhPPIdA130PrkqpNC1XBfc09fqY61j6E8uJQz+tsndexB2t3aolsdzb+pmBpGExmSlbs6W+GVZxZ/TCFbtgYER3vyzn23yxlwemWw/vaTgK8MQK+Etm/Uxcl0bKjO6CXQM0AcchLCTCd8Ee29xjLYZbkGVTpWrBoDRft7sebM2yjKOc2c2p+Ew0ePyrFr3VTqkvyIUZhIBKvmqRvGsEBKKhFBT/2h36GC4W3BSGoX/S1Z4+YQIakd8iP99bgfsZvmiWzP4UC844re8GjP51SU3JiUxpea5jIjcXNfQO2CCxQvH79MFcURU6BA2MVq+Tae9sAGwNtIqJPJnJ03hIzQcWPE/+vpiKYgDctvV0el6MbfDa/7whtkGMbUijcHdcfOklxIxby+M6helJCBokTXfGFlVae5RIORbxkpEaiTiHbZvAvgjXeLlRop/8jwyv8aHKu3l7FedZUHbGkfoMV2ExHCwbYNu6Kx4ngUFzBYqy+KwOXvTI0o=
  secret_access_key:
    secure: OdjTzGgDsSatEvPBuND4y9QNjusTXcJVuBApXq1p6Sa4tX/6zrqB4k1Su1z+WfvdPlWaJ81BoQjlWnhEbKvBibOEImM2Fw7nbKntYmSyLprG6s5UHfQ4pTxaF35FdpsWOxenLywmjPr/U9JZ5Qdwce53FAg3hqAeAdE/09jIwefoWHR9kP3UBJOV0WKaYvAmnBjypJufT985hRNN59DFQnVtJWikU77vp604ArX+7jGNBOg+9huhegIpqTApEJuNX2+bkwRROCx/fAYFjrff/qOPFTFJbBToPLGNLawgDlEzZ/iXwDjBxm01U/gii+ixPv/6zm6BwLOg/tzfPHEodEHde9zEgH9rd1dEC08CnqY2SJOpKBNjdKudvdZiVpNKJEye/ebOoUSh9oRCPUjfwIkQN1fzvMat51Fto81QXbq503m+jCgISoYAWaPLFUvA0ijWnfqHOzUlzIbDoDvznPtkW/1N+JfDE8VfzMJNGT7TMD38wTIhPQYU88hJe1tw0n0sf8GoFfPs5VmIu/x1Yk5aus3lu3IQW530CqKOuyHRODjfpyBrWtUTJx7Fjk8goRuaey9/gDXL4XYyNRjx2qz4UdFi+MKuezxD9EkU2Lqt3PKEAhW6zdk268rLLgSl/1PAvQomLogbERcYwzzVdVvsp0xVZcCBdIgOuu5ERCc=
    # secure: prKdiPz2nDNb3zUpDI5xKDfb6JhFTkEkVQFw965zAoLz6j4A4+XBywjPQ10x5fuZ5lm0at680Kb7vXIaL1ofTBImg5DLs79byh6R0muRvflJ95F0QQVy6x3J80oMD9KeUOy6kTgLSwIyv3V9OADfeo4+SZWwo/x7mv4ss9hwrzxOuD+L0a6fPUUQQbIKsQ4T408wEMLUjr7sDCCaqN28VDnJACTrAL2Oj8IGHOYzXaYpin6vfdasI/ICA2ClHxXADCg3gWg02oQQiRwI51N2L33KBb9SBQDlk3/G4nkvP0m7ikAZsWy7QBpc7skEZzrb+VjblsuH+DWnCdaITbbQB0qPTb86c/rcFkY5wIMxwK7plEfUvLoncphuJBkIEbeQr5IhRt8UuFM4bx4IXOuBw7yko2RvZiXwUL9qlN//UAWueKJWeP44Vft4nvmUPlY3hKHZrO1J4ExUCzJ6HwISviCUo+zrozCh9ubL8iDxgRLz41mG1Dk2/QxWT4uclDUmGDucgId6shrAWGxlejYsSvzNOGicoC/pasl+tTl0ItX19oNNHHxDcAcjrmhKAyktOQNdlnBUB/Q1WMr4XiKKmLgB50zqV2nywaIOgMoHzOhY3g65htX18/ReFB+0SadL7bDXIv90RtYyLpimRb+ciez/FngHFCHfcyeKAS8JMWA=
  bucket: $GLIMPSE_BUCKET_NAME
  region: us-east-1
  upload_dir: $GLIMPSE_FUNCTION_DIR
  local_dir: dist/function
  skip_cleanup: true
  on:
    branch: build
